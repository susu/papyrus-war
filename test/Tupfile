include_rules

ifeq (@(TUP_PLATFORM),linux)
# OpenGlStubs is not portable, unit tests are supported only on linux right now

CXXFLAGS+= -Iigloo/

: foreach *.cpp |> !cxx |> %B.o | $(GCNO_OUT) {test_objs}

LDFLAGS+= -l$(LIBCW_GRAPH) -l$(LIBCW_CORE) -L$(LD_PATH) $(OPENGL_LIBS)

: {test_objs} | $(LD_PATH)/$(LIBCW_GRAPH_SO) $(LD_PATH)/$(LIBCW_CORE_SO) |> !o2bin |> test_runner

ifeq (@(VALGRIND),y)
  #VALGRIND=valgrind --leak-check=yes --error-exitcode=255
endif

: test_runner |> LD_LIBRARY_PATH=$(LD_PATH) $(VALGRIND) ./test_runner --verbose|>
endif
